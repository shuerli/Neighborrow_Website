const condition_pill={"Brand New":'<span class="badge badge-success" style="position:absolute;z-index:100;right:10px;top:10px;">Brand New</span>',"Like New":'<span class="badge badge-primary" style="position:absolute;z-index:100;right:10px;top:10px;">Like New</span>',"Very Good":'<span class="badge badge-info" style="position:absolute;z-index:100;right:10px;top:10px;color: white;">Very Good</span>',Good:'<span class="badge badge-warning" style="position:absolute;z-index:100;right:10px;top:10px;">Good</span>',Adequate:'<span class="badge badge-light" style="position:absolute;z-index:100;right:10px;top:10px;">Adequate</span>',Defective:'<span class="badge badge-dark" style="position:absolute;z-index:100;right:10px;top:10px;">Defective</span>'},state_lookup={AL:"Alabama",AK:"Alaska",AS:"American Samoa",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District Of Columbia",FM:"Federated States Of Micronesia",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MH:"Marshall Islands",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",MP:"Northern Mariana Islands",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PW:"Palau",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NL:"Newfoundland and Labrador",NT:"Northwest Territories",NS:"Nova Scotia",NU:"Nunavut",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",YT:"Yukon Territory"};let filterOut_status={"Brand New":!1,"Like New":!1,"Very Good":!1,Good:!1,Adequate:!1,Defective:!1},postcode_lock=!1,postcode_current=null,cache=null;$(document).ready(function(){document.getElementById("itemISBN_section").style.display="None",document.getElementById("itemNameBrand_section").style.display="None",document.getElementById("corrected_results_section").style.display="None",document.getElementById("no_results_section").style.display="None";let e=new URL(window.location.href),t=e.searchParams.get("keyword"),r=e.searchParams.get("city"),n=e.searchParams.get("country"),o=e.searchParams.get("province");"USA"!==n&&"Canada"!==n||(o=state_lookup[e.searchParams.get("province")]),fetch("/result_api?keyword="+t+"&city="+r+"&province="+o+"&country="+n).then(e=>e.json()).then(e=>{console.log(e),cache=e,document.getElementById("current_city").innerText=e.given_city,document.getElementById("current_province").innerText=e.given_province,document.getElementById("current_country").innerText=e.given_country,null!==e.result_userEmail.result?0!==e.result_userEmail.result.length&&user_render(e.result_userEmail):document.getElementById("user_section").style.display="none",item_render(e)}).then(()=>{$("#brandnew_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status["Brand New"]=!1:filterOut_status["Brand New"]=!0,item_render(cache)}),$("#likenew_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status["Like New"]=!1:filterOut_status["Like New"]=!0,item_render(cache)}),$("#verygood_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status["Very Good"]=!1:filterOut_status["Very Good"]=!0,item_render(cache)}),$("#good_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status.Good=!1:filterOut_status.Good=!0,item_render(cache)}),$("#adequate_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status.Adequate=!1:filterOut_status.Adequate=!0,item_render(cache)}),$("#defective_checkbox").on("change",function(){$(this).is(":checked")?filterOut_status.Defective=!1:filterOut_status.Defective=!0,item_render(cache)})})});let user_render=e=>{document.getElementById("suggested_user_name").innerText=e.result[0].display_name,document.getElementById("user_card").onclick=(()=>{window.location="/user/profile/"+e.result[0].id}),null!==e.borrowRate[0].borrow_rate?document.getElementById("suggest_user_borrow_rate").innerText=parseFloat(e.borrowRate[0].borrow_rate).toFixed(2):document.getElementById("suggest_user_borrow_rate").innerText="None",null!==e.lendRate[0].lend_rate?document.getElementById("suggest_user_lend_rate").innerText=parseFloat(e.lendRate[0].lend_rate).toFixed(2):document.getElementById("suggest_user_lend_rate").innerText="None","Male"==e.result[0].gender?document.getElementById("suggested_user_gender").innerHTML='<i class="fa fa-mars text-primary" aria-hidden="true"></i>':"Female"==e.result[0].gender?document.getElementById("suggested_user_gender").innerHTML='<i class="fa fa-mars text-danger" aria-hidden="true"></i>':document.getElementById("suggested_user_gender").innerHTML="",document.getElementById("suggested_user_photo").src=e.display_photo,document.getElementById("user_card").onclick=function(){window.location="/public_profiles/"+e.result[0].id},document.getElementById("user_section").style.display=""},item_render=e=>{document.getElementById("itemISBN_section_content").innerHTML="",document.getElementById("itemNameBrand_section_content").innerHTML="",document.getElementById("itemISBN_section_content").innerHTML="",document.getElementById("no_results_section").style.display="none";let t=0;if(null!==e.result_itemISBN&&e.result_itemISBN!==undefined){document.getElementById("isbn_result_length").innerText=e.result_itemISBN.length,document.getElementById("isbn_keyword").innerText=e.search_keyword;for(let r=0;r<e.result_itemISBN.length;r++){if(filterOut_status[e.result_itemISBN[r].itemCondition])continue;if(postcode_lock&&null!==postcode_current&&-1===e.result_itemISBN[r].postcode.toLowerCase().replace(" ","").indexOf(postcode_current))continue;let n=0;if(null!==e.search_byISBN_requestsCount){let t=e.search_byISBN_requestsCount.filter(t=>t.itemID==e.result_itemISBN[r].itemID);t.length>0&&(n=t[0].count)}let o=0;null!==e.search_byISBN_lenderRate&&(o=e.search_byISBN_lenderRate[e.result_itemISBN[r].ownerID]),document.getElementById("itemISBN_section_content").innerHTML+='<div class="col-lg-3 col-md-4 col-sm-6"><div class="card"><span class="item_detail_span" style="cursor:pointer" onclick="location.href = \'/items/'+e.result_itemISBN[r].itemID+'\'"><img class="card-img-top img-thumbnail" style="width:100%;height:250px; border-top-width: 0px; border-right-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px;padding-right: 0px;padding-bottom: 0px;padding-left: 0px;" src="'+e.result_itemISBN[r].itemPhoto+'" alt="Card image cap"/>'+condition_pill[e.result_itemISBN[r].itemCondition]+'<div class="card-body" style="padding-left: 10px;padding-bottom: 10px;padding-top: 10px;"><div style="line-height: 1.5em; height: 3em;overflow: hidden;"><strong class="card-title text-dark">'+e.result_itemISBN[r].name+'</strong></div><small class="text-dark"><u>Borrowed by '+n+' user(s)</u></small></div><hr style="margin-top:0;margin-bottom:0;" /></span><div class="card-body user_detail_span" onclick="location.href = \'/public_profiles/'+e.result_itemISBN[r].ownerID+'\';" style="cursor: pointer;padding-left: 10px;padding-bottom: 2px;padding-top: 5px;"><span><img class="img-thumbnail" style="width:30px; height:30px; border-radius: 50%; padding-top:0; padding-bottom:0; padding-left:0; padding-right:0;" src="'+e.search_byISBN_lenderPhoto[e.result_itemISBN[r].ownerID]+'"/>&nbsp; <label class="text-muted">'+e.result_itemISBN[r].ownerName+'</label><label class="pull-right text-warning" style="margin-top:1.5px;"><i class="fa fa-star"></i> '+parseFloat(o).toFixed(1)+"</label></span></div></div></div>",t++}t++,document.getElementById("itemISBN_section").style.display=""}if(0!==e.result_itemNameBrand.length&&null!==e.result_itemNameBrand&&e.result_itemNameBrand!==undefined){document.getElementById("namebrand_result_count").innerText=e.result_itemNameBrand.length,document.getElementById("namebrand_keyword").innerText=e.search_keyword;for(let r=0;r<e.result_itemNameBrand.length;r++){if(filterOut_status[e.result_itemNameBrand[r].itemCondition])continue;if(postcode_lock&&null!==postcode_current&&-1===e.result_itemNameBrand[r].postcode.toLowerCase().replace(" ","").indexOf(postcode_current))continue;let n=0;if(null!==e.search_byNameBrand_requestsCount){let t=e.search_byNameBrand_requestsCount.filter(t=>t.itemID==e.result_itemNameBrand[r].itemID);t.length>0&&(n=t[0].count)}let o=0;null!==e.search_byItemNameAndBrand_lenderRate&&(o=e.search_byItemNameAndBrand_lenderRate[e.result_itemNameBrand[r].ownerID]),console.log(o.toString()),document.getElementById("itemNameBrand_section_content").innerHTML+='<div class="col-lg-3 col-md-4 col-sm-6"><div class="card"><span class="item_detail_span" style="cursor:pointer" onclick="location.href = \'/items/'+e.result_itemNameBrand[r].itemID+'\'"><img class="card-img-top img-thumbnail" style="width:100%;height:250px; border-top-width: 0px; border-right-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px;padding-right: 0px;padding-bottom: 0px;padding-left: 0px;" src="'+e.result_itemNameBrand[r].itemPhoto+'" alt="Card image cap"/>'+condition_pill[e.result_itemNameBrand[r].itemCondition]+'<div class="card-body" style="padding-left: 10px;padding-bottom: 10px;padding-top: 10px;"><div style="line-height: 1.5em; height: 3em;overflow: hidden;"><strong class="card-title text-dark">'+e.result_itemNameBrand[r].name+'</strong></div><small class="text-dark"><u>Borrowed by '+n+' user(s)</u></small></div><hr style="margin-top:0;margin-bottom:0;" /></span><div class="card-body user_detail_span" onclick="location.href = \'/public_profiles/'+e.result_itemNameBrand[r].ownerID+'\';" style="cursor: pointer;padding-left: 10px;padding-bottom: 2px;padding-top: 5px;"><span><img class="img-thumbnail" style="width:30px; height:30px; border-radius: 50%; padding-top:0; padding-bottom:0; padding-left:0; padding-right:0;" src="'+e.search_byItemNameAndBrand_lenderPhoto[e.result_itemNameBrand[r].ownerID]+'"/>&nbsp; <label class="text-muted">'+e.result_itemNameBrand[r].ownerName+'</label><label class="pull-right text-warning" style="margin-top:1.5px;"><i class="fa fa-star"></i> '+parseFloat(o).toFixed(1)+"</label></span></div></div></div>",t++}document.getElementById("itemNameBrand_section").style.display=""}if(0===t)if(null!==e.result_correctedKeyword&&e.result_correctedKeyword!==undefined&&""!==e.corrected_keyword&&null!==e.corrected_keyword){document.getElementById("original_keyword").innerText=e.search_keyword,document.getElementById("corrected_keyword_results_count").innerText=e.result_correctedKeyword.length,document.getElementById("corrected_keyword").innerText=e.corrected_keyword;for(let r=0;r<e.result_correctedKeyword.length;r++){if(filterOut_status[e.result_correctedKeyword[r].itemCondition])continue;if(postcode_lock&&null!==postcode_current&&-1===e.result_correctedKeyword[r].postcode.toLowerCase().replace(" ","").indexOf(postcode_current))continue;let n=0;if(null!==e.search_byCorrection_requestsCount){let t=e.search_byCorrection_requestsCount.filter(t=>t.itemID==e.result_correctedKeyword[r].itemID);t.length>0&&(n=t[0].count)}let o=0;null!==e.search_byCorrection_lenderRate&&(o=e.search_byCorrection_lenderRate[e.result_correctedKeyword[r].ownerID]),document.getElementById("corrected_results_section_content").innerHTML+='<div class="col-lg-3 col-md-4 col-sm-6"><div class="card"><span class="item_detail_span" style="cursor:pointer" onclick="location.href = \'/items/'+e.result_correctedKeyword[r].itemID+'\'"><img class="card-img-top img-thumbnail" style="width:100%;height:250px; border-top-width: 0px; border-right-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px;padding-right: 0px;padding-bottom: 0px;padding-left: 0px;" src="'+e.result_correctedKeyword[r].itemPhoto+'" alt="Card image cap"/>'+condition_pill[e.result_correctedKeyword[r].itemCondition]+'<div class="card-body" style="padding-left: 10px;padding-bottom: 10px;padding-top: 10px;"><div style="line-height: 1.5em; height: 3em;overflow: hidden;"><strong class="card-title text-dark">'+e.result_correctedKeyword[r].name+'</strong></div><small class="text-dark"><u>Borrowed by '+n+' user(s)</u></small></div><hr style="margin-top:0;margin-bottom:0;" /></span><div class="card-body user_detail_span" onclick="location.href = \'/public_profiles/'+e.result_correctedKeyword[r].ownerID+'\';" style="cursor: pointer;padding-left: 10px;padding-bottom: 2px;padding-top: 5px;"><span><img class="img-thumbnail" style="width:30px; height:30px; border-radius: 50%; padding-top:0; padding-bottom:0; padding-left:0; padding-right:0;" src="'+e.search_byCorrection_lenderPhoto[e.result_correctedKeyword[r].ownerID]+'"/>&nbsp; <label class="text-muted">'+e.result_correctedKeyword[r].ownerName+'</label><label class="pull-right text-warning" style="margin-top:1.5px;"><i class="fa fa-star"></i> '+parseFloat(o).toFixed(1)+"</label></span></div></div></div>",t++}document.getElementById("corrected_results_section").style.display=""}else document.getElementById("keyword_no_results").innerText=e.search_keyword,document.getElementById("no_results_section").style.display=""},postcode_filter=e=>{if(0===e.value.length&&(postcode_lock=!1,postcode_current=null,item_render(cache)),"Canada"===document.getElementById("current_country").innerText)if(e.value.length>=3&&e.value.length<6)postcode_lock=!0,postcode_current=e.value.slice(0,3).toLowerCase(),item_render(cache);else{if(6!==e.value.length)return postcode_lock=!1,postcode_current=null,void item_render(cache);postcode_lock=!0,postcode_current=e.value.toLowerCase(),item_render(cache)}else postcode_lock=!0,postcode_current=e.value.toLowerCase(),item_render(cache)};